---
import type { HTMLAttributes } from "astro/types";
import { parse } from "node-html-parser";

type Props = HTMLAttributes<"svg"> & {
  // https://tabler.io/icons
  name: string;
  strokeWidth: number,
}

export async function importIcon(name: string) {
  const tablerIcon = await import(`../../node_modules/@tabler/icons/icons/${name}.svg?raw`);
  return tablerIcon.default;
}

const { name, strokeWidth = "1.5", ...attrs } = Astro.props;

const icon = await importIcon(name);
const svg = parse(icon).querySelector("svg");

Object.keys(attrs)
  .filter((k) => k == "class" || k.startsWith("data-") || k.startsWith("aria-") || k.startsWith("x-") )
  .forEach((k) => {
    svg?.setAttribute(k, attrs[k] as string);
  });

svg.setAttribute("stroke-width", strokeWidth);
---

<Fragment set:html={svg} />
